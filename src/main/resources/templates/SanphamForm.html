<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sản phẩm from</title>
    <!-- Thêm link CSS của Bootstrap 4 -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Thêm thư viện jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <!-- Thêm script của Bootstrap 4 -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body>
<nav class="navbar navbar-dark bg-dark navbar-expand-lg">

    <ul class="navbar-nav">
        <li class="nav-item">
            <a class="nav-link" href="#" th:href="@{/danhmuc/list}">QL danh mục</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" th:href="@{/loaisanpham/list}">QL Loại sản phẩm</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" th:href="@{/sanpham/list}">QL sản phẩm</a>
        </li>

    </ul>
</nav>
<div class="container  text-center">

    <div class="row">
        <div class="col-sm-4">
            <div><h1>Sản phẩm</h1></div>

            <form id="frmsanpham" name="frmsanpham" >
                <div class="form-group">
                    
                    <input type="hidden" id="idsanpham" name="idsanpham" class="form-control"  required>

                    <div align="left"><label class="text-left mt-2 mb-2" for="tensanpham">Tên sản phẩm</label></div>
                    <input type="text" id="tensanpham" name="tensanpham"  class="form-control"  required>

                    <div align="left"> <label class="text-left mt-2 mb-2" for="gia">Giá</label></div>
                    <input type="text" id="gia" name="gia"  class="form-control"  required>

                    <div align="left"><label class="text-left mt-2 mb-2" for="gia">Danhmuc</label></div>
                    <select  class="form-control " id="iddanhmuc" name="iddanhmuc">
                        <option  ></option>
                    
                    </select>

                    <div align="left"><label class="text-left mt-2 mb-2" for="gia">Loại sản phẩm</label></div>
                    <select   class="form-control " id="idloaisanpham" name="idloaisanpham">
                        <option ></option>
                    </select>

                </div>
                <div class="form-group">
                    <div id="actionButtons"><a id="save" onclick="addsanpham()" class="btn btn-success">Save</a> <a class="btn btn-success" onclick="openSanpham()">Back</a></div>
                    <div id="updateButtons" style="display:none;"><a id="update" onclick="updatesanpham()" class="btn btn-success" >Update</a> <a class="btn btn-success" onclick="openSanpham()">Back</a></div>

                </div>
            </form>
        </div>
    </div>
</div>


<script>

        $(document).ready(function () {
            var urlPart = window.location.href.split('/');
            var idsanpham  = urlPart.slice(-1)[0];
            console.log(idsanpham);

                loadSanphamData(idsanpham);
                loadDanhmucDropdown();
                loadLoaisanphamDropdown();
                toggleButtons();

        });

        function loadSanphamData(idsanpham) {
                $.ajax({
                    type: "GET",
                    url: "/sanpham/" + idsanpham,
                    success: function (data) {

                        $("#idsanpham").val(data.idsanpham);
                        $("#tensanpham").val(data.tensanpham);
                        $("#gia").val(data.gia);

                        loadDanhmucDropdown(data.danhmuc.iddanhmuc);
                        loadLoaisanphamDropdown(data.loaisanpham.idloaisanpham);
                        toggleButtons();
                    },
                    error: function (error) {
                        console.log("Error loading san pham data for editing:", error);
                    }
                });
            }


            function loadDanhmucDropdown(selectedDanhmucId) {
                $.ajax({
                    type: "GET",
                    url: "/danhmuc/",
                    success: function (data) {
                      var dropdown = $("#iddanhmuc");
                        dropdown.empty();

                        $.each(data, function (index, danhmuc) {
                            dropdown.append($("<option></option>")
                                .attr("value", danhmuc.iddanhmuc)
                                .text(danhmuc.tendanhmuc));
                        });

                        if (selectedDanhmucId) {
                            dropdown.val(selectedDanhmucId);
                        }
                    },
                    error: function (error) {
                        console.log("Error loading danhmuc data:", error);
                    }
                });
            }

            function loadLoaisanphamDropdown(selectedLoaisanphamId) {

                $.ajax({
                    type: "GET",
                    url: "/loaisanpham/",
                    success: function (data) {

                        var dropdown = $("#idloaisanpham");
                        dropdown.empty();



                        $.each(data, function (index, loaisanpham) {
                            dropdown.append($("<option></option>")
                                .attr("value", loaisanpham.idloaisanpham)
                                .text(loaisanpham.tenloaisanpham));
                        });


                        if (selectedLoaisanphamId) {
                            dropdown.val(selectedLoaisanphamId);
                        }
                    },
                    error: function (error) {
                        console.log("Error loading loaisanpham data:", error);
                    }
                });
            }


        function openSanpham() {
            window.location.href = "/sanpham/list";
        }
        function addsanpham() {
            var tensanpham = $("#tensanpham").val();
            var gia = $("#gia").val();
            var iddanhmuc = $("#iddanhmuc").val();
            var idloaisanpham = $("#idloaisanpham").val();

            $.ajax({
                type: "POST",
                url: "/sanpham/save",
                contentType: "application/json",
                data: JSON.stringify({ "tensanpham": tensanpham,
                    "gia": gia,
                    "danhmuc": {"iddanhmuc": iddanhmuc},
                    "loaisanpham": {"idloaisanpham": idloaisanpham} }),
                success: function () {
                    window.location.href = "/sanpham/list";

                },
                error: function (error) {
                    console.log("Error adding danh muc:", error);
                }
            });
        }

        function updatesanpham() {
            var idsanpham = $("#idsanpham").val();
            var tensanpham = $("#tensanpham").val();
            var gia = $("#gia").val();
            var iddanhmuc = $("#iddanhmuc").val();
            var idloaisanpham = $("#idloaisanpham").val();

            $.ajax({
                type: "POST",
                url: "/sanpham/save",
                contentType: "application/json",
                data: JSON.stringify({ "idsanpham": idsanpham, "tensanpham": tensanpham,"gia":gia,"danhmuc": {"iddanhmuc": iddanhmuc},
                    "loaisanpham": {"idloaisanpham": idloaisanpham} }),
                success: function () {
                    window.location.href = "/sanpham/list";
                },
                error: function (error) {
                    console.log("Error updating san pham:", error);
                }
            });
        }
        function toggleButtons() {
            var idsanpham = $("#idsanpham").val();
            if (idsanpham) {
                $("#updateButtons").show();
                $("#actionButtons").hide();
            } else {
                $("#actionButtons").show();
                $("#updateButtons").hide();
            }
        }



</script>

</body>
</html>