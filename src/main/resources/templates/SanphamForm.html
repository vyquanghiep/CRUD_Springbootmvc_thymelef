<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sản phẩm from</title>
    <!-- Thêm link CSS của Bootstrap 4 -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Thêm thư viện jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <!-- Thêm script của Bootstrap 4 -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body>
<nav class="navbar navbar-dark bg-dark navbar-expand-lg">

    <ul class="navbar-nav">
        <li class="nav-item">
            <a class="nav-link" href="#" th:href="@{/danhmuc/list}">QL danh mục</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" th:href="@{/loaisanpham/list}">QL Loại sản phẩm</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" th:href="@{/sanpham/list}">QL sản phẩm</a>
        </li>

    </ul>
</nav>
<div class="container  text-center">
    <div th:if="${sanpham.idsanpham == null}"><h1>Create New Category</h1></div>
    <div th:if="${sanpham.idsanpham != null}"><h1>Edit Category</h1></div>
    <div class="row">
        <div class="col-sm-4">

            <form id="frmsanpham" name="frmsanpham" th:object = "${sanpham}">
                <div class="form-group">
                    
                    <input type="hidden" id="idsanpham" name="idsanpham" class="form-control" th:field="*{idsanpham}" required> >
                   
                    <label class="text-left mt-2 mb-2" for="tensanpham">Tên sản phẩm</label>
                    <input type="text" id="tensanpham" name="tensanpham"  class="form-control" th:field="*{tensanpham}" required>
                   
                    <label class="text-left mt-2 mb-2" for="gia">Giá</label>
                    <input type="text" id="gia" name="gia"  class="form-control" th:field="*{gia}" required>
                    
                    <label class="text-left mt-2 mb-2" for="gia">Danhmuc</label>
                    <select th:field="${sanpham.danhmuc.iddanhmuc}" class="form-control " id="iddanhmuc" name="iddanhmuc">
                        <option th:each="lsm: ${listdanhmucs}" th:value="${lsm.iddanhmuc}" th:text="${lsm.tendanhmuc}"></option>
                    
                    </select>
                    
                    <label class="text-left mt-2 mb-2" for="gia">Loại sản phẩm</label>
                    <select th:field="${sanpham.loaisanpham.idloaisanpham}"  class="form-control " id="idloaisanpham" name="idloaisanpham">
                        <option th:each="lsp : ${listloaisanpham}" th:value="${lsp.idloaisanpham}" th:text="${lsp.tenloaisanpham}"></option>
                    </select>

                </div>
                <div class="form-group">
                    <div th:if="${sanpham.idsanpham == null}"><a id="save" onclick="addsanpham()" class="btn btn-success">Save</a> <a class="btn btn-success" th:href="@{/sanpham/list}">Back</a></div>
                    <div th:unless="${sanpham.idsanpham == null}"><a id="update" onclick="updatesanpham()" class="btn btn-success" >Save</a> <a class="btn btn-success" th:href="@{/sanpham/list}">Back</a></div>

                </div>
            </form>
        </div>
    </div>
</div>


<script>

    function addsanpham() {
        var tensanpham = $("#tensanpham").val();
        var gia = $("#gia").val();
        var iddanhmuc = $("#iddanhmuc").val();
        var idloaisanpham = $("#idloaisanpham").val();

        $.ajax({
            type: "POST",
            url: "/sanpham/save",
            contentType: "application/json",
            data: JSON.stringify({ "tensanpham": tensanpham,
                "gia": gia,
                "danhmuc": {"iddanhmuc": iddanhmuc},
                "loaisanpham": {"idloaisanpham": idloaisanpham} }),
            success: function () {
                window.location.href = "/sanpham/list";

            },
            error: function (error) {
                console.log("Error adding danh muc:", error);
            }
        });
    }

    function updatesanpham() {
        var idsanpham = $("#idsanpham").val();
        var tensanpham = $("#tensanpham").val();
        var gia = $("#gia").val();
        var iddanhmuc = $("#iddanhmuc").val();
        var idloaisanpham = $("#idloaisanpham").val();

        $.ajax({
            type: "POST",
            url: "/sanpham/save",
            contentType: "application/json",
            data: JSON.stringify({ "idsanpham": idsanpham, "tensanpham": tensanpham,"gia":gia,"danhmuc": {"iddanhmuc": iddanhmuc},
                "loaisanpham": {"idloaisanpham": idloaisanpham} }),
            success: function () {
                window.location.href = "/sanpham/list";
            },
            error: function (error) {
                console.log("Error updating san pham:", error);
            }
        });
    }
    $(document).ready(function () {
        var urlParams = new URLSearchParams(window.location.search);
        var idsanpham = urlParams.get('id');
        if (idsanpham) {
            editSanpham(idsanpham);
        }
    });


</script>

</body>
</html>