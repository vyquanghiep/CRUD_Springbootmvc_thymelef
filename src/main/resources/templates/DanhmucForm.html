<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form Danh Mục</title>
  <!-- Thêm link CSS của Bootstrap 4 -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <!-- Thêm thư viện jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <!-- Thêm script của Bootstrap 4 -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body>
<nav class="navbar navbar-dark bg-dark navbar-expand-lg">

  <ul class="navbar-nav">
    <li class="nav-item">
      <a class="nav-link" href="#" th:href="@{/danhmuc/list}">QL danh mục</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" th:href="@{/loaisanpham/list}">QL Loại sản phẩm</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" th:href="@{/sanpham/list}">QL sản phẩm</a>
    </li>

  </ul>
</nav>
<div class="container  text-center">

  <div class="row">
    <div class="col-sm-4">
      <h1 id="formTitle">Danh mục</h1>

      <form id="frmDanhmuc" name="frmDanhmuc" >
        <div class="form-group">
          <input type="hidden" id="iddanhmuc" name="iddanhmuc" class="form-control"  required>
          <div align="left"><label  for="tendanhmuc">Tên danh mục</label></div>
          <input type="text" id="tendanhmuc" name="tendanhmuc"  class="form-control"  required>
        </div>
        <div class="form-group">
          <div id="actionButtons"><a id="save" onclick="addDanhmuc()" class="btn btn-success">Save</a> <a class="btn btn-success" onclick="openDanhmuc()">Back</a></div>
          <div id="updateButtons" style="display:none;"><a id="update" onclick="updateDanhmuc()" class="btn btn-success" >Update</a> <a class="btn btn-success" onclick="openDanhmuc()">Back</a></div>

        </div>
      </form>
    </div>
  </div>
</div>


<script>
  $(document).ready(function () {
    var urlPart = window.location.href.split('/');
    var iddanhmuc  = urlPart.slice(-1)[0];
    console.log(iddanhmuc);
    loadDanhmucForm(iddanhmuc);
    });

  function loadDanhmucForm(iddanhmuc) {
      $.ajax({
        type: "GET",
        url: "/danhmuc/" + iddanhmuc,
        success: function (data) {
          $("#iddanhmuc").val(data.iddanhmuc);
          $("#tendanhmuc").val(data.tendanhmuc);
          toggleButtons()
        },
        error: function (error) {
          console.log("Error loading danh muc data for editing:", error);
        }
      });
    }

  function openDanhmuc() {
    window.location.href = "/danhmuc/list";
  }

  function toggleButtons() {
    var iddanhmuc = $("#iddanhmuc").val();
    if (iddanhmuc) {
      $("#updateButtons").show();
      $("#actionButtons").hide();
    } else {
      $("#actionButtons").show();
      $("#updateButtons").hide();
    }
  }

  function addDanhmuc() {
    var tendanhmuc = $("#tendanhmuc").val();

    $.ajax({
      type: "POST",
      url: "/danhmuc/save",
      contentType: "application/json",
      data: JSON.stringify({ "tendanhmuc": tendanhmuc }),
      success: function () {
        window.location.href = "/danhmuc/list";

      },
      error: function (error) {
        console.log("Error adding danh muc:", error);
      }
    });
  }

  function updateDanhmuc() {
    var iddanhmuc = $("#iddanhmuc").val();
    var tendanhmuc = $("#tendanhmuc").val();
    $.ajax({
      type: "POST",
      url: "/danhmuc/save",
      contentType: "application/json",
      data: JSON.stringify({ "iddanhmuc": iddanhmuc, "tendanhmuc": tendanhmuc }),
      success: function () {
        window.location.href = "/danhmuc/list";
      },
      error: function (error) {
        console.log("Error updating danh muc:", error);
      }
    });
  }



</script>

</body>
</html>
