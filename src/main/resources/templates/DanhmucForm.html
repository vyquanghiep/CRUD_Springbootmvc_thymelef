<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Form Danh Mục</title>
  <!-- Thêm link CSS của Bootstrap 4 -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <!-- Thêm thư viện jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  <!-- Thêm script của Bootstrap 4 -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</head>
<body>
<nav class="navbar navbar-dark bg-dark navbar-expand-lg">

  <ul class="navbar-nav">
    <li class="nav-item">
      <a class="nav-link" href="#" th:href="@{/danhmuc/list}">QL danh mục</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" th:href="@{/loaisanpham/list}">QL Loại sản phẩm</a>
    </li>
    <li class="nav-item">
      <a class="nav-link" th:href="@{/sanpham/list}">QL sản phẩm</a>
    </li>

  </ul>
</nav>
<div class="container  text-center">
  <div th:if="${danhmuc.iddanhmuc == null}"><h1>Create New Category</h1></div>
  <div th:if="${danhmuc.iddanhmuc != null}"><h1>Edit Category</h1></div>
  <div class="row">
    <div class="col-sm-4">

      <form id="frmDanhmuc" name="frmDanhmuc" th:object = "${danhmuc}">
        <div class="form-group">
          <input type="hidden" id="iddanhmuc" name="iddanhmuc" class="form-control" th:field="*{iddanhmuc}" required> >
          <label for="tendanhmuc">Tên danh mục</label>
          <input type="text" id="tendanhmuc" name="tendanhmuc"  class="form-control" th:field="*{tendanhmuc}" required>
        </div>
        <div class="form-group">
          <div th:if="${danhmuc.iddanhmuc == null}"><a id="save" onclick="addDanhmuc()" class="btn btn-success">Save</a> <a class="btn btn-success" th:href="@{/danhmuc/list}">Back</a></div>
          <div th:unless="${danhmuc.iddanhmuc == null}"><a id="update" onclick="updateDanhmuc()" class="btn btn-success" >Save</a> <a class="btn btn-success" th:href="@{/danhmuc/list}">Back</a></div>

        </div>
      </form>
    </div>
  </div>
</div>


<script>

  function addDanhmuc() {
    var tendanhmuc = $("#tendanhmuc").val();

    $.ajax({
      type: "POST",
      url: "/danhmuc/save",
      contentType: "application/json",
      data: JSON.stringify({ "tendanhmuc": tendanhmuc }),
      success: function () {
        window.location.href = "/danhmuc/list";

      },
      error: function (error) {
        console.log("Error adding danh muc:", error);
      }
    });
  }

  function updateDanhmuc() {
    var iddanhmuc = $("#iddanhmuc").val(); // Lấy giá trị từ trường input ẩn
    var tendanhmuc = $("#tendanhmuc").val();

    $.ajax({
      type: "POST",
      url: "/danhmuc/save",
      contentType: "application/json",
      data: JSON.stringify({ "iddanhmuc": iddanhmuc, "tendanhmuc": tendanhmuc }),
      success: function () {
        window.location.href = "/danhmuc/list";
      },
      error: function (error) {
        console.log("Error updating danh muc:", error);
      }
    });
  }
  $(document).ready(function () {
    var urlParams = new URLSearchParams(window.location.search);
    var iddanhmuc = urlParams.get('id');
    if (iddanhmuc) {
      editDanhmuc(iddanhmuc);
    }
  });


</script>

</body>
</html>
